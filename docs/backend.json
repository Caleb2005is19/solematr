{
  "entities": {
    "Shoe": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Shoe",
      "type": "object",
      "description": "Represents a shoe product in the store.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Shoe entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the shoe."
        },
        "brand": {
          "type": "string",
          "description": "Brand of the shoe."
        },
        "style": {
          "type": "string",
          "description": "Style of the shoe (e.g., running, casual, formal)."
        },
        "size": {
          "type": "number",
          "description": "Available size of the shoe."
        },
        "description": {
          "type": "string",
          "description": "Detailed description of the shoe."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of the shoe's image.",
          "format": "uri"
        },
        "price": {
          "type": "number",
          "description": "Price of the shoe."
        }
      },
      "required": [
        "id",
        "name",
        "brand",
        "style",
        "size",
        "description",
        "imageUrl",
        "price"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the SoleMate application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "firstName": {
          "type": "string",
          "description": "First name of the user."
        },
        "lastName": {
          "type": "string",
          "description": "Last name of the user."
        }
      },
      "required": [
        "id",
        "email",
        "firstName",
        "lastName"
      ]
    },
    "CartItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "CartItem",
      "type": "object",
      "description": "Represents an item in the user's shopping cart.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the CartItem entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N CartItem)"
        },
        "shoeId": {
          "type": "string",
          "description": "Reference to Shoe. (Relationship: Shoe 1:N CartItem)"
        },
        "quantity": {
          "type": "number",
          "description": "Quantity of the shoe in the cart."
        }
      },
      "required": [
        "id",
        "userId",
        "shoeId",
        "quantity"
      ]
    },
    "Order": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Order",
      "type": "object",
      "description": "Represents a completed order.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Order entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Order)"
        },
        "orderDate": {
          "type": "string",
          "description": "Date and time when the order was placed.",
          "format": "date-time"
        },
        "totalAmount": {
          "type": "number",
          "description": "Total amount of the order."
        }
      },
      "required": [
        "id",
        "userId",
        "orderDate",
        "totalAmount"
      ]
    },
    "OrderItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "OrderItem",
      "type": "object",
      "description": "Represents an item within an order.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the OrderItem entity."
        },
        "orderId": {
          "type": "string",
          "description": "Reference to Order. (Relationship: Order 1:N OrderItem)"
        },
        "shoeId": {
          "type": "string",
          "description": "Reference to Shoe. (Relationship: Shoe 1:N OrderItem)"
        },
        "quantity": {
          "type": "number",
          "description": "Quantity of the shoe in the order item."
        },
        "price": {
          "type": "number",
          "description": "Price of the shoe in the order item."
        }
      },
      "required": [
        "id",
        "orderId",
        "shoeId",
        "quantity",
        "price"
      ]
    },
    "Recommendation": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Recommendation",
      "type": "object",
      "description": "Represents an AI-powered shoe style recommendation for a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Recommendation entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Recommendation)"
        },
        "shoeId": {
          "type": "string",
          "description": "Reference to Shoe. (Relationship: Shoe 1:N Recommendation)"
        },
        "recommendationDate": {
          "type": "string",
          "description": "Date when the recommendation was generated.",
          "format": "date-time"
        },
        "reason": {
          "type": "string",
          "description": "Reason for the recommendation (e.g., 'Based on browsing history')."
        }
      },
      "required": [
        "id",
        "userId",
        "shoeId",
        "recommendationDate",
        "reason"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/shoes/{shoeId}",
        "definition": {
          "entityName": "Shoe",
          "schema": {
            "$ref": "#/backend/entities/Shoe"
          },
          "description": "Stores shoe product information.",
          "params": [
            {
              "name": "shoeId",
              "description": "Unique identifier for the shoe."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/cart_items/{cartItemId}",
        "definition": {
          "entityName": "CartItem",
          "schema": {
            "$ref": "#/backend/entities/CartItem"
          },
          "description": "Stores items in the user's shopping cart.  Parent user id is used for ownership.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user."
            },
            {
              "name": "cartItemId",
              "description": "Unique identifier for the cart item."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/orders/{orderId}",
        "definition": {
          "entityName": "Order",
          "schema": {
            "$ref": "#/backend/entities/Order"
          },
          "description": "Stores user's order history.  Parent user id is used for ownership.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user."
            },
            {
              "name": "orderId",
              "description": "Unique identifier for the order."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/orders/{orderId}/order_items/{orderItemId}",
        "definition": {
          "entityName": "OrderItem",
          "schema": {
            "$ref": "#/backend/entities/OrderItem"
          },
          "description": "Stores items within a specific order. Parent user and order ids are used for ownership.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user."
            },
            {
              "name": "orderId",
              "description": "Unique identifier for the order."
            },
            {
              "name": "orderItemId",
              "description": "Unique identifier for the order item."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/recommendations/{recommendationId}",
        "definition": {
          "entityName": "Recommendation",
          "schema": {
            "$ref": "#/backend/entities/Recommendation"
          },
          "description": "Stores AI-powered shoe style recommendations for a user. Parent user id is used for ownership.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user."
            },
            {
              "name": "recommendationId",
              "description": "Unique identifier for the recommendation."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support the SoleMate e-commerce application, focusing on shoe browsing, product details, AI-powered recommendations, shopping cart management, and secure checkout. The structure prioritizes Authorization Independence by avoiding hierarchical authorization dependencies, ensuring robust security rules and atomic operations. Structural Segregation ensures all documents in a collection share the same security requirements, simplifying rules and improving security. Access Modeling uses path-based ownership for user-related data and existence checks for global roles. Data Clarity and Predictability are maintained through explicit state modeling, predictable schema, and semantic naming conventions.\n\n**Authorization Independence:**\nUser-owned data, such as cart items and orders, are nested under the `/users/{userId}` path, ensuring clear ownership and simplifying security rules. No `get()` calls are required to determine ownership.\n\n**QAPs Support:**\n*   Secure listing of shoes is achieved by storing all shoes in a single `/shoes` collection with consistent security requirements.\n*   User-specific data (cart, orders, recommendations) is stored under `/users/{userId}`, providing secure and efficient access control.\n\nThe structure facilitates simple, robust, and easily debuggable security rules."
  }
}